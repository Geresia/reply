<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>미니 게시판 · 부트/톰캣 없이 동작</title>
  <style>
    /* ===== 밝은(라이트) 테마 ===== */
    :root{
      --bg: #f7f9fc;        /* 밝은 배경 */
      --panel: #ffffff;      /* 카드 배경 */
      --text: #1b1c1f;       /* 본문 글자 */
      --muted: #6b7280;      /* 보조 글자 */
      --accent: #2f6df6;     /* 파란 포인트 */
      --accent-2:#22c55e;    /* 초록 포인트 */
      --danger:#ef4444;      /* 경고 */
      --border: #e5e7eb;     /* 테두리 */
      --chip: #f1f5f9;       /* 칩 배경 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font: 16px/1.55 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Arial, Apple SD Gothic Neo, "맑은 고딕", sans-serif;
    }
    .wrap{ max-width: 960px; margin: 0 auto; padding: 20px; }

    header.top{
      position: sticky; top:0; z-index: 50;
      backdrop-filter: blur(10px);
      background: color-mix(in srgb, var(--bg) 70%, transparent);
      border-bottom: 1px solid var(--border);
    }
    .top-inner{
      max-width: 960px; margin:0 auto; padding:12px 20px;
      display:flex; gap:12px; align-items:center; justify-content:space-between;
    }
    .brand{ font-weight:800; letter-spacing:0.2px }

    .badge{
      display:inline-flex; align-items:center; gap:6px;
      padding:6px 10px; border:1px solid var(--border); border-radius:999px;
      font-size:12px; color:var(--muted); background: #fff;
    }

    .card{
      background: var(--panel); border:1px solid var(--border); border-radius: 16px; padding: 18px;
      box-shadow: 0 8px 26px rgba(16,24,40,.06);
    }
    .list{ display:grid; gap:12px; }
    .title{ font-size: 22px; font-weight: 800; margin:0 0 8px }
    .muted{ color: var(--muted); font-size: 14px }

    .actions{ display:flex; gap:10px; flex-wrap:wrap; }
    .btn{
      appearance:none; border:1px solid var(--border); background:#f8fafc; color:var(--text);
      padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:700
    }
    .btn.primary{
      background: var(--accent); color:#fff; border-color: color-mix(in srgb, var(--accent) 60%, var(--border));
      box-shadow: 0 6px 20px rgba(47,109,246,.25)
    }
    .btn.ghost{ background: transparent }
    .btn.danger{
      background: var(--danger); color: #fff; border-color: color-mix(in srgb, var(--danger) 60%, var(--border));
    }
    .btn:disabled{ opacity:.6; cursor:not-allowed }

    form .row{ display:grid; gap:6px; margin: 12px 0 }
    input[type="text"], textarea{
      width:100%; background:#ffffff; color:var(--text);
      border:1px solid var(--border); border-radius:12px; padding:12px 12px; outline:none;
    }
    textarea{ min-height: 140px; resize: vertical; }

    .post-meta{ display:flex; gap:10px; align-items:center; flex-wrap: wrap }
    .chip{ font-size:12px; color:#334155; background: var(--chip); border:1px solid var(--border); padding:6px 10px; border-radius:999px }
    .content{ white-space: pre-wrap; word-break: break-word; }
    .divider{ height:1px; background:var(--border); margin:16px 0 }

    .comment-item{ padding:12px; border:1px solid var(--border); border-radius:12px; background:#ffffff }
    .comment-meta{ display:flex; gap:8px; align-items:center; color:#475569; font-size:13px; margin-bottom:6px }
    .reply-block{ margin-top:8px; }
    .empty{ padding: 24px; text-align:center; color: var(--muted) }
    .footer-note{ text-align:center; color:var(--muted); font-size:12px; margin-top:16px }

    /* === 모달/오버레이 === */
    .overlay{
      position:fixed; inset:0; background:rgba(0,0,0,.35);
      display:flex; align-items:center; justify-content:center; padding:16px; animation: fadeIn .12s ease;
    }
    .modal{
      width:100%; max-width:820px; background:var(--panel); border:1px solid var(--border); border-radius:16px; padding:18px;
      box-shadow:0 24px 60px rgba(16,24,40,.24); animation: pop .14s ease;
    }
    @keyframes fadeIn{ from{ opacity:0 } to{ opacity:1 } }
    @keyframes pop{ from{ transform: translateY(6px) scale(.98) } to{ transform: translateY(0) scale(1) } }
  </style>
</head>
<body>
  <header class="top">
    <div class="top-inner">
      <div class="brand"></div>
      <div class="topbar-right" style="display:flex; gap:8px; align-items:center">
        <button id="writeBtn" class="btn primary" type="button">작성하기</button>
      </div>
    </div>
  </header>

  <div class="wrap">
    <div id="app"></div>
    <div class="footer-note">JavaScript (라이트 테마)</div>
  </div>

  <script>
    // ===== 상태 =====
    const app = document.getElementById('app');
    let state = { posts: [], nextId: 1 };
    let ui = { replyOpenFor: {} };
    const fmt = (ts)=> new Date(ts).toLocaleString();

    // ===== 유틸 DOM 헬퍼 =====
    function h(tag, attrs={}, ...children){
      const el = document.createElement(tag);
      for(const [k,v] of Object.entries(attrs||{})){
        if(k === 'class') el.className = v;
        else if(k.startsWith('on') && typeof v === 'function') el.addEventListener(k.slice(2).toLowerCase(), v);
        else if(k === 'href') el.setAttribute('href', v);
        else if(k === 'value') el.value = v;
        else el.setAttribute(k, v);
      }
      children.flat().forEach(c=>{
        if(c==null) return;
        if(typeof c === 'string' || typeof c === 'number') el.appendChild(document.createTextNode(c));
        else el.appendChild(c);
      });
      return el;
    }
    function navigate(hash){ location.hash = hash; }

    function render(){
      const hash = location.hash || '#/list';
      const [_, route, id] = hash.split('/');
      if(route === 'post' && id){
        renderList();
        openPost(parseInt(id), false);
        return;
      }
      return renderList();
    }

    // ===== 목록 =====
    function renderList(){
      app.innerHTML = '';
      const header = h('div', {class:'card'},
        h('div', {class:'title'}, '게시글 목록'),
        h('div', {class:'muted'}, '상단 "작성하기" 버튼으로 모달 작성창이 열립니다.')
      );
      app.appendChild(header);

      const listWrap = h('div', {class:'list'});
      if(state.posts.length === 0){
        listWrap.appendChild(h('div', {class:'card empty'}, '아직 글이 없습니다. 첫 글을 작성해보세요!'));
      }else{
        const posts = [...state.posts].sort((a,b)=> b.createdAt - a.createdAt);
        posts.forEach(p=>{
          listWrap.appendChild(
            h('div', {class:'card'},
              h('div', {class:'title'}, p.title),
              h('div', {class:'post-meta'},
                h('span', {class:'chip'}, `작성자 · ${p.author||'익명'}`),
                h('span', {class:'chip'}, `작성일 · ${fmt(p.createdAt)}`),
                h('span', {class:'chip'}, `댓글 · ${countComments(p.comments)}개`)
              ),
              h('div', {class:'actions', style:'margin-top:10px'},
                h('button', {class:'btn', onClick:()=>openPost(p.id, true)}, '자세히 보기')
              )
            )
          );
        });
      }
      app.appendChild(listWrap);
    }

    function countComments(arr){
      if(!arr) return 0;
      let n=0;
      const dfs=(a)=>a.forEach(c=>{n++; if(c.replies&&c.replies.length) dfs(c.replies)});
      dfs(arr);
      return n;
    }

    // ===== 상세(모달) + 댓글/대댓글 =====
    function openPost(id, pushHash){
      const p = state.posts.find(x=>x.id===id);
      if(!p){ alert('해당 게시글을 찾을 수 없습니다.'); return; }
      if(pushHash) navigate(`#/post/${id}`);
      if(document.getElementById('postOverlay')) return;

      const overlay = h('div', {id:'postOverlay', class:'overlay', onClick:(e)=>{
        if(e.target.id==='postOverlay') closePost();
      }},
        h('div', {class:'modal'},
          h('div', {class:'card'},
            h('div', {class:'title'}, p.title),
            h('div', {class:'post-meta'},
              h('span', {class:'chip'}, `작성자 · ${p.author||'익명'}`),
              h('span', {class:'chip'}, `작성일 · ${fmt(p.createdAt)}`)
            ),
            h('div', {class:'divider'}),
            h('div', {class:'content'}, p.content),
            h('div', {class:'divider'}),
            h('div', {class:'actions'},
              h('button', {class:'btn', onClick:closePost}, '닫기')
            )
          ),
          (function(){
            const comments = p.comments || (p.comments = []);
            const wrap = h('div');
            const section = h('div', {class:'card'});
            section.append(
              h('div', {class:'title'}, `댓글 (${countComments(comments)})`),
              comments.length === 0 ? h('div', {class:'empty'}, '첫 댓글을 남겨보세요!') : renderCommentList(p, comments, 0)
            );

            const form = h('form', {class:'card', onsubmit:onSubmitComment});
            form.append(
              h('div', {class:'title'}, '댓글 쓰기'),
              h('div', {class:'row'},
                h('label', null, '작성자 (선택)'),
                h('input', {type:'text', id:'cAuthor', placeholder:'닉네임 또는 이름'})
              ),
              h('div', {class:'row'},
                h('label', null, '내용'),
                h('textarea', {id:'cContent', placeholder:'댓글 내용을 입력하세요'})
              ),
              h('div', {class:'actions'},
                h('button', {type:'submit', class:'btn primary'}, '등록')
              )
            );

            function onSubmitComment(e){
              e.preventDefault();
              const author = form.querySelector('#cAuthor').value.trim();
              const content = form.querySelector('#cContent').value.trim();
              if(!content){ alert('댓글 내용을 입력하세요'); return; }
              comments.push({ id: Date.now(), author, content, createdAt: Date.now(), replies: [] });
              document.getElementById('postOverlay').remove();
              openPost(id, false); // 최신 반영
            }

            wrap.append(section, form);
            return wrap;
          })()
        )
      );

      document.body.appendChild(overlay);
      overlay.addEventListener('keydown', (e)=>{
        if(e.key==='Escape') closePost();
      });
    }

    function closePost(){
      const ov = document.getElementById('postOverlay');
      if(ov) ov.remove();
      navigate('#/list');
    }

    function renderCommentList(post, arr, depth){
      const list = h('div', {class:'list'});
      arr.forEach(c=>{
        const item = h('div', {class:'comment-item', style:`margin-left:${depth*16}px`});
        item.append(
          h('div', {class:'comment-meta'}, `${c.author||'익명'}`, ' · ', fmt(c.createdAt)),
          h('div', {class:'content'}, c.content),
          h('div', {class:'reply-block'},
            h('div', {class:'actions'},
              h('button', {class:'btn ghost', onClick:()=>{ toggleReplyBox(c.id); }},
                ui.replyOpenFor[c.id] ? '닫기' : '답글'
              )
            ),
            ui.replyOpenFor[c.id] ? makeReplyForm(post, c.id) : null
          )
        );
        if(c.replies && c.replies.length){
          item.append(renderCommentList(post, c.replies, Math.min(depth+1, 6)));
        }
        list.appendChild(item);
      });
      return list;
    }

    function toggleReplyBox(cid){
      ui.replyOpenFor[cid] = !ui.replyOpenFor[cid];
      render();
    }

    function makeReplyForm(post, parentId){
      const f = h('form', {onsubmit:onSubmitReply});
      f.append(
        h('div', {class:'row'}, h('input', {type:'text', name:'author', placeholder:'작성자 (선택)'})),
        h('div', {class:'row'}, h('textarea', {name:'content', placeholder:'대댓글 내용을 입력하세요'})),
        h('div', {class:'actions'}, h('button', {class:'btn primary', type:'submit'}, '등록'))
      );

      function onSubmitReply(e){
        e.preventDefault();
        const author = f.querySelector('[name="author"]').value.trim();
        const content = f.querySelector('[name="content"]').value.trim();
        if(!content){ alert('내용을 입력하세요'); return; }
        const target = findCommentById(post.comments, parentId);
        if(!target){ alert('대상 댓글을 찾을 수 없습니다.'); return; }
        (target.replies || (target.replies=[])).push({ id: Date.now(), author, content, createdAt: Date.now(), replies: [] });
        ui.replyOpenFor[parentId] = false;
        document.getElementById('postOverlay').remove();
        openPost(post.id, false);
      }
      return f;
    }

    function findCommentById(arr, id){
      for(const c of arr){
        if(c.id === id) return c;
        if(c.replies && c.replies.length){
          const r = findCommentById(c.replies, id);
          if(r) return r;
        }
      }
      return null;
    }

    // ===== 작성 모달 =====
    function openCompose(){
      if(document.getElementById('composeOverlay')) return;
      const overlay = h('div', {id:'composeOverlay', class:'overlay', onClick:(e)=>{
        if(e.target.id==='composeOverlay') closeCompose();
      }},
        h('div', {class:'modal'},
          h('form', {id:'composeForm', onsubmit:onSubmitNew},
            h('div', {class:'title'}, '새 글 쓰기'),
            h('div', {class:'row'},
              h('label', null, '제목'),
              h('input', {type:'text', id:'title', placeholder:'예) 오늘 만든 프로젝트 공유합니다'})
            ),
            h('div', {class:'row'},
              h('label', null, '작성자 (선택)'),
              h('input', {type:'text', id:'author', placeholder:'닉네임 또는 이름'})
            ),
            h('div', {class:'row'},
              h('label', null, '내용'),
              h('textarea', {id:'content', placeholder:'내용을 입력하세요 (Ctrl/Cmd+Enter로 등록)'})
            ),
            h('div', {class:'actions'},
              h('button', {class:'btn', type:'button', onClick:closeCompose}, '취소'),
              h('button', {class:'btn primary', type:'submit'}, '등록')
            )
          )
        )
      );
      document.body.appendChild(overlay);
      overlay.querySelector('#title').focus();

      overlay.addEventListener('keydown', (e)=>{
        if((e.ctrlKey||e.metaKey) && e.key==='Enter'){
          e.preventDefault();
          overlay.querySelector('#composeForm').dispatchEvent(new Event('submit', {cancelable:true}));
        }
        if(e.key==='Escape') closeCompose();
      });

      function onSubmitNew(e){
        e.preventDefault();
        const title = overlay.querySelector('#title').value.trim();
        const author = overlay.querySelector('#author').value.trim();
        const content = overlay.querySelector('#content').value.trim();
        if(!title){ alert('제목을 입력하세요'); return; }
        if(!content){ alert('내용을 입력하세요'); return; }
        const post = { id: state.nextId++, title, author, content, createdAt: Date.now(), comments: [] };
        state.posts.push(post);
        closeCompose();
        renderList();
      }
    }

    function closeCompose(){
      const ov = document.getElementById('composeOverlay');
      if(ov) ov.remove();
    }

    // ===== 초기화 =====
    const writeBtn = document.getElementById('writeBtn');
    writeBtn.addEventListener('click', openCompose);
    window.addEventListener('hashchange', render);
    render();
  </script>
</body>
</html>
